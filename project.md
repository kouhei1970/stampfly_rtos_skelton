## 目的
StampFlyの制御用ファームのスケルトンを実装する


## 仕様
以下の仕様や作業規範を守ること
- スケルトンとはメインタスクに実装するべき飛行制御タスクを省略し、プログラムの各タスク、センサの読み込み、キャリブレーション、StampFlyの各状態などを一元管理するクラス、コントローラとの通信、CLIにてセンサの値の取得や将来実装する制御ゲインの調整などある、制御をこれから実装したい人のために、それ以外のものは全て提供したものをスケルトンと呼ぶ。
- ESP-IDF環境での開発
- FreeRTOSを使用
- C++を使用し、クラスを用いた実装をする
- 以下に示すGithubにStampFlyの使用に関するドキュメントが存在する
- 最高速タスクは角度・角速度制御タスクで400Hz
- センサのタスクは各センサのデータ出力能力に応じて周期を設定して分ける
- その他必要に応じてタスクを作る
- 以下にない地磁気センサ、気圧高度計のドライバは新たに実装する
- IMUはFIFO取得をしてセンサ内部では1600Khzでサンプリングをし、取得した際に位置姿勢推定機に入れる前にフィルタリングすることを検討する。
- 以下のドライバはC＋＋のラッパが存在しているんものとしていないものに分かれるないものはC＋＋ラッパを付け加える
- 位置姿勢推定ライブラリも以下のGithubに示されているので活用する
- センサ出力等やゲイン設定をUSB_SERIALで接続してCLIコンソールでできるものとする
- コントローラのGithubを参照する。その際for_tdmaブランチを確認すること。コントローラとStampFlyの通信を確立する。StampFlyからのテレメトリー機能はコントローラの現在の実装は古いので、今回のプログラムで新たにプロトコルも含めて検討して新規に作り上げる。こちらの実装を下敷きにして後日コントローラの実装を改修する。
- センサの外れ値処理は注意を払う
- コントローラとのペアリング機能
- リセットボタンGPIO0を押すことによるリセット機能
- 電圧電流監視機能、3.4Vを下回ったら電池充電サインを出す
- ブザーを活用した状況を知らせる機能
- RGBLEDを活用した内部状態を知らせる機能
- 出来上がった各モジュールの単体テスト、統合テストを実施し確実に動くかチェックする
- ビルドは逐次実施し、コードに初歩的なエラーがないか確認する
- モータ制御に関するコンポーネントを作る
- モータの番号は右前を基準に時計回りに番号を振る
- 最後に全体のドキュメントを作成し、制御を実装したい、エンジニアが自由に組み込めるように支援する
- 作業は逐次Githubにプッシュする


## StampFlyの技術資料
https://github.com/M5Fly-kanazawa/StampFly_technical_specification

## IMU(BMI270)のドライバ
https://github.com/kouhei1970/stampfly_imu

## ToFのドライバ
https://github.com/kouhei1970/stampfly_tof

## optical flowセンサのドライバ
https://github.com/kouhei1970/stampfly_opticalflow

## ESKFによる位置姿勢推定機
https://github.com/kouhei1970/stampfly-eskf-estimator

## コントローラのコード
https://github.com/M5Fly-kanazawa/Simple_StampFly_Joy
最新版はfor_tdmaブランチであるのでそちらのプログラムに合わせて実装する
